#!/bin/bash
batch_size=8
if [ $# -eq 0 ]; then
    echo "use: [ SORT_OPTIONS=... ] $0 <file> [ <file> ... ]" >&2
    exit 1
elif [ $# -eq 1 ]; then
    exec cat "$1"
elif [ $# -le $batch_size ]; then
    sort -m --batch-size=$batch_size $SORT_OPTIONS "$@"
else
    let "n=$#/8"
    command="sort -m --batch-size=$batch_size $SORT_OPTIONS"
    if [ $n -eq 1 ]; then
	command="$command ${@:1:7}"
    else
	for i in $(seq 0 6); do
	    command="$command <($0 ${@:$(($n * $i + 1)):$n})"
	done
    fi
    command="$command <($0 ${@:$(($n * 7 + 1))})"
    eval $command
fi
